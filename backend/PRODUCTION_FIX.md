# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (Render.com)

## –ü—Ä–æ–±–ª–µ–º–∞

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π:
- `/me` —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ `/my-courses` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401
- Race condition –º–µ–∂–¥—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π auth –∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. Secure Cookies –¥–ª—è HTTPS

**Backend (`main.py`):**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- Cookies —Ç–µ–ø–µ—Ä—å `secure=True` –¥–ª—è HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- `secure=False` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (HTTP)

```python
is_production = os.getenv("RENDER") is not None or os.getenv("ENVIRONMENT") == "production"
secure_cookie = is_production
```

### 2. –£–ª—É—á—à–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è AuthContext

**Frontend (`AuthContext.tsx`):**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `loadUser()` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞, —á—Ç–æ–±—ã cookie —É—Å–ø–µ–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è

### 3. –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

**Frontend (`Profile.tsx`):**
- `enabled` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ `isAuthenticated` –∏ `authLoading`, –Ω–æ –∏ –Ω–∞–ª–∏—á–∏–µ `user`
- –î–æ–±–∞–≤–ª–µ–Ω retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- Retry –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è 401 –æ—à–∏–±–æ–∫

### 4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

- –î–æ–±–∞–≤–ª–µ–Ω `staleTime: 30000` –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Render.com

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Render:

1. **FRONTEND_URL** - URL –≤–∞—à–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–¥–ª—è CORS)
   ```
   https://your-frontend.vercel.app
   ```

2. **ENVIRONMENT** - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
   ```
   production
   ```

### CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `FRONTEND_URL` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Render:
- Settings ‚Üí Environment Variables
- –î–æ–±–∞–≤—å—Ç–µ: `FRONTEND_URL` = `https://your-frontend.vercel.app`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å

### –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. Cookies –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `Secure` –∏ `HttpOnly` –≤ DevTools
2. `/me` –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ
3. `/my-courses` –Ω–µ –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 401 –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞

## –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–∫–∞–ª—å–Ω–æ –≤—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ:
- `secure=False` –¥–ª—è localhost
- –ó–∞–¥–µ—Ä–∂–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã –∏ –Ω–µ –∑–∞–º–µ—Ç–Ω—ã

